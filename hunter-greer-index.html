<html lang="en">
  <head>
    <title>Rustici Software - Initial Developer Hiring Test</title>
    <style>
      body {
        font-family: sans-serif;
        font-size: 14px;
        line-height: 20px;
      }
      li.question {
        padding-top: 5px;
        padding-bottom: 5px;
      }
      label.choice {
        display: block;
      }
      .correct {
        color: #336897;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <h2>Randomized Questions</h2>
    <ul id="questions"></ul>

    <script>
      (function () {
        function randomizeTest(test) {
          const { questions, choices, answers } = test;

          function adjacentShuffle(...arrays) {
            let n = arrays[0].length;

            while (n) {
              const i = Math.floor(Math.random() * n--);

              arrays.forEach(array => {
                const temp = array[n];
                array[n] = array[i];
                array[i] = temp;
              });
            }
          }

          for (let i = questions.length - 1; i >= 0; i--) {
            adjacentShuffle(answers[i], choices[i]);
          }

          adjacentShuffle(questions, answers, choices);

          return test;
        }

        function Test(questions, choices, answers) {
          this.questions = questions;
          this.choices = choices;
          this.answers = answers;
        }

        function renderTest(test, parent) {
          const randomizedTest = randomizeTest(test);

          for (let i = 0; i < randomizedTest.questions.length; i += 1) {
            const qElement = document.createElement("li");
            let correctCount = 0;

            qElement.setAttribute("class", "question");
            qElement.appendChild(
              document.createTextNode(randomizedTest.questions[i])
            );

            for (let j = 0; j < randomizedTest.answers[i].length; j += 1) {
              if (randomizedTest.answers[i][j] === 1) {
                correctCount += 1;
              }
            }

            for (let j = 0; j < randomizedTest.choices[i].length; j += 1) {
              const choiceLabelElement = document.createElement("label"),
                choiceInputElement = document.createElement("input");

              choiceInputElement.setAttribute(
                "name",
                (correctCount === 1 ? "radio" : "check") + i
              );
              choiceInputElement.setAttribute(
                "type",
                correctCount === 1 ? "radio" : "checkbox"
              );
              choiceInputElement.setAttribute("value", j);

              choiceLabelElement.classList.add("choice");
              if (randomizedTest.answers[i][j] === 1) {
                choiceLabelElement.classList.add("correct");
              }

              choiceLabelElement.appendChild(choiceInputElement);
              choiceLabelElement.appendChild(
                document.createTextNode(randomizedTest.choices[i][j])
              );

              qElement.appendChild(choiceLabelElement);
              parent.appendChild(qElement);
            }
          }
        }

        const questions = [
            "What can you find in Rustici Software's office?",
            "All of Rustici Software employees are expected to work no more than ____ hours per week.",
            "The end users of Rustici Software's products number in the _________",
            "Rustici Software is a (choose all that apply):",
            "Tim likes to wear:",
          ],
          choices = [
            [
              "Dart Board",
              "Ping Pong Table",
              "Cubicles",
              "Laptops with dual monitors",
              "TPS reports, ummm yeah",
            ],
            ["80", "40", "50", "60"],
            ["Tens", "Hundreds", "Thousands", "Millions", "Billions"],
            [
              "Great place to work",
              "Respected leader in its field",
              "Place where people don't matter, just results",
            ],
            ["Capri pants", "Goth attire", "Sport coat", "T-shirt and shorts"],
          ],
          answers = [
            [1, 1, 0, 1, 0],
            [0, 1, 0, 0],
            [0, 0, 0, 1, 0],
            [1, 1, 0],
            [0, 0, 0, 1],
          ];

        let qus = [],
          chs = [],
          ans = [];

        for (let i = 0; i < 10; i++) {
          qus = qus.concat(questions);
          ans = ans.concat(answers);
          chs = cs.concat(choices);
        }

        console.log(qus, chs, ans);

        // const test = new Test(qus, chs, ans);
        const test = new Test(questions, choices, answers);

        renderTest(test, document.getElementById("questions"));
      })();
    </script>
  </body>
</html>
